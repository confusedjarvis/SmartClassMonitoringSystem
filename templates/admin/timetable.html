{% extends "layout.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page">Manage Timetable</li>
            </ol>
        </nav>
        <h1 class="display-5 fw-bold text-info">
            <i class="fas fa-calendar-alt me-2"></i>Manage Timetable
        </h1>
        <p class="lead">Create and manage class schedules</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-lg-4 mb-4 mb-lg-0">
        <div class="card">
            <div class="card-header bg-info bg-opacity-10">
                <h4 class="mb-0 text-info">
                    <i class="fas fa-plus-circle me-2"></i><span id="formTitle">Add Timetable Entry</span>
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('admin.timetable') }}" id="timetableForm">
                    {{ form.hidden_tag() }}
                    <input type="hidden" name="timetable_id" id="timetable_id" value="">
                    <input type="hidden" name="is_update" id="is_update" value="0">
                    
                    <div class="mb-3">
                        {{ form.course_id.label(class="form-label") }}
                        {% if form.course_id.errors %}
                            {{ form.course_id(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.course_id.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.course_id(class="form-control") }}
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        {{ form.faculty_id.label(class="form-label") }}
                        {% if form.faculty_id.errors %}
                            {{ form.faculty_id(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.faculty_id.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.faculty_id(class="form-control") }}
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        {{ form.year.label(class="form-label") }}
                        {% if form.year.errors %}
                            {{ form.year(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.year.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.year(class="form-control") }}
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        {{ form.day.label(class="form-label") }}
                        {% if form.day.errors %}
                            {{ form.day(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.day.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.day(class="form-control") }}
                        {% endif %}
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-6">
                            {{ form.start_time.label(class="form-label") }}
                            {% if form.start_time.errors %}
                                {{ form.start_time(class="form-control is-invalid") }}
                                <div class="invalid-feedback">
                                    {% for error in form.start_time.errors %}
                                        <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.start_time(class="form-control", placeholder="HH:MM") }}
                            {% endif %}
                        </div>
                        <div class="col-6">
                            {{ form.end_time.label(class="form-label") }}
                            {% if form.end_time.errors %}
                                {{ form.end_time(class="form-control is-invalid") }}
                                <div class="invalid-feedback">
                                    {% for error in form.end_time.errors %}
                                        <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.end_time(class="form-control", placeholder="HH:MM") }}
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        {{ form.room.label(class="form-label") }}
                        {% if form.room.errors %}
                            {{ form.room(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.room.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.room(class="form-control", placeholder="e.g., LH101") }}
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="d-grid">
                                {{ form.submit(class="btn btn-info", id="submitBtn") }}
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="d-grid">
                                <button type="button" class="btn btn-secondary" id="cancelBtn" style="display: none;">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-info bg-opacity-10">
                <h4 class="mb-0 text-info">
                    <i class="fas fa-calendar-week me-2"></i>Weekly Schedule
                </h4>
            </div>
            <div class="card-body">
                <!-- Year filter tabs -->
                <ul class="nav nav-pills mb-3" id="yearTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="all-years-tab" data-bs-toggle="pill" 
                                data-bs-target="#all-years" type="button" role="tab" 
                                aria-controls="all-years" aria-selected="true">
                            All Years
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="year-1-tab" data-bs-toggle="pill" 
                                data-bs-target="#year-1" type="button" role="tab" 
                                aria-controls="year-1" aria-selected="false">
                            Year 1
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="year-2-tab" data-bs-toggle="pill" 
                                data-bs-target="#year-2" type="button" role="tab" 
                                aria-controls="year-2" aria-selected="false">
                            Year 2
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="year-3-tab" data-bs-toggle="pill" 
                                data-bs-target="#year-3" type="button" role="tab" 
                                aria-controls="year-3" aria-selected="false">
                            Year 3
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="year-4-tab" data-bs-toggle="pill" 
                                data-bs-target="#year-4" type="button" role="tab" 
                                aria-controls="year-4" aria-selected="false">
                            Year 4
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="yearTabsContent">
                    <div class="tab-pane fade show active" id="all-years" role="tabpanel" aria-labelledby="all-years-tab">
                        <!-- Days tabs for all years -->
                        <ul class="nav nav-tabs mb-4" id="dayTabs" role="tablist">
                            {% for day in days %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link {% if loop.first %}active{% endif %}" 
                                            id="{{ day.lower() }}-tab" 
                                            data-bs-toggle="tab" 
                                            data-bs-target="#{{ day.lower() }}" 
                                            type="button" 
                                            role="tab" 
                                            aria-controls="{{ day.lower() }}" 
                                            aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                        {{ day }}
                                    </button>
                                </li>
                            {% endfor %}
                        </ul>
                        
                        <div class="tab-content" id="dayTabsContent">
                            {% for day in days %}
                                <div class="tab-pane fade {% if loop.first %}show active{% endif %}" id="{{ day.lower() }}" role="tabpanel" aria-labelledby="{{ day.lower() }}-tab">
                                    {% if timetable_entries[day] %}
                                        <div class="list-group">
                                            {% for entry in timetable_entries[day] %}
                                                <div class="list-group-item">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h5 class="mb-1">{{ entry.course.course_code }} - {{ entry.course.name }} (Year {{ entry.year }})</h5>
                                                            <p class="mb-1 text-muted">
                                                                <i class="fas fa-clock me-1"></i>{{ entry.start_time.strftime('%H:%M') }} - {{ entry.end_time.strftime('%H:%M') }}
                                                                <i class="fas fa-map-marker-alt ms-3 me-1"></i>{{ entry.room }}
                                                                <i class="fas fa-user ms-3 me-1"></i>{{ entry.faculty.name }}
                                                                <i class="fas fa-graduation-cap ms-3 me-1"></i>Year {{ entry.year }}
                                                            </p>
                                                        </div>
                                                        <div>
                                                            <button type="button" class="btn btn-sm btn-primary edit-timetable-btn" 
                                                                   data-id="{{ entry.id }}"
                                                                   data-course-id="{{ entry.course_id }}"
                                                                   data-faculty-id="{{ entry.faculty_id }}"
                                                                   data-year="{{ entry.year }}"
                                                                   data-day="{{ entry.day }}"
                                                                   data-start-time="{{ entry.start_time.strftime('%H:%M') }}"
                                                                   data-end-time="{{ entry.end_time.strftime('%H:%M') }}"
                                                                   data-room="{{ entry.room }}">
                                                                <i class="fas fa-edit me-1"></i>Edit
                                                            </button>
                                                            <form method="POST" action="{{ url_for('admin.delete_timetable', timetable_id=entry.id) }}" class="d-inline" 
                                                                  onsubmit="return confirm('Are you sure you want to delete this timetable entry? This action cannot be undone.');">
                                                                <button type="submit" class="btn btn-sm btn-danger">
                                                                    <i class="fas fa-trash me-1"></i>Delete
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-calendar-times text-muted mb-3" style="font-size: 3rem;"></i>
                                            <h5 class="text-muted">No classes scheduled for {{ day }}</h5>
                                            <p>Add a new timetable entry using the form on the left</p>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Year 1 Tab Content -->
                    <div class="tab-pane fade" id="year-1" role="tabpanel" aria-labelledby="year-1-tab">
                        <!-- Days tabs for Year 1 -->
                        <ul class="nav nav-tabs mb-4" id="year1DayTabs" role="tablist">
                            {% for day in days %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link {% if loop.first %}active{% endif %}" 
                                            id="year1-{{ day.lower() }}-tab" 
                                            data-bs-toggle="tab" 
                                            data-bs-target="#year1-{{ day.lower() }}" 
                                            type="button" 
                                            role="tab" 
                                            aria-controls="year1-{{ day.lower() }}" 
                                            aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                        {{ day }}
                                    </button>
                                </li>
                            {% endfor %}
                        </ul>
                        
                        <div class="tab-content" id="year1DayTabsContent">
                            {% for day in days %}
                                <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                                    id="year1-{{ day.lower() }}" 
                                    role="tabpanel" 
                                    aria-labelledby="year1-{{ day.lower() }}-tab">
                                    
                                    {% set year1_entries = [] %}
                                    {% for entry in timetable_entries[day] %}
                                        {% if entry.year == 1 %}
                                            {% set _ = year1_entries.append(entry) %}
                                        {% endif %}
                                    {% endfor %}
                                    
                                    {% if year1_entries %}
                                        <div class="list-group">
                                            {% for entry in year1_entries %}
                                                <div class="list-group-item">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h5 class="mb-1">{{ entry.course.course_code }} - {{ entry.course.name }}</h5>
                                                            <p class="mb-1 text-muted">
                                                                <i class="fas fa-clock me-1"></i>{{ entry.start_time.strftime('%H:%M') }} - {{ entry.end_time.strftime('%H:%M') }}
                                                                <i class="fas fa-map-marker-alt ms-3 me-1"></i>{{ entry.room }}
                                                                <i class="fas fa-user ms-3 me-1"></i>{{ entry.faculty.name }}
                                                            </p>
                                                        </div>
                                                        <div>
                                                            <button type="button" class="btn btn-sm btn-primary edit-timetable-btn" 
                                                                   data-id="{{ entry.id }}"
                                                                   data-course-id="{{ entry.course_id }}"
                                                                   data-faculty-id="{{ entry.faculty_id }}"
                                                                   data-year="{{ entry.year }}"
                                                                   data-day="{{ entry.day }}"
                                                                   data-start-time="{{ entry.start_time.strftime('%H:%M') }}"
                                                                   data-end-time="{{ entry.end_time.strftime('%H:%M') }}"
                                                                   data-room="{{ entry.room }}">
                                                                <i class="fas fa-edit me-1"></i>Edit
                                                            </button>
                                                            <form method="POST" action="{{ url_for('admin.delete_timetable', timetable_id=entry.id) }}" class="d-inline" 
                                                                  onsubmit="return confirm('Are you sure you want to delete this timetable entry? This action cannot be undone.');">
                                                                <button type="submit" class="btn btn-sm btn-danger">
                                                                    <i class="fas fa-trash me-1"></i>Delete
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-calendar-times text-muted mb-3" style="font-size: 3rem;"></i>
                                            <h5 class="text-muted">No classes scheduled for Year 1 on {{ day }}</h5>
                                            <p>Add a new timetable entry using the form on the left</p>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Year 2 Tab Content -->
                    <div class="tab-pane fade" id="year-2" role="tabpanel" aria-labelledby="year-2-tab">
                        <!-- Days tabs for Year 2 -->
                        <ul class="nav nav-tabs mb-4" id="year2DayTabs" role="tablist">
                            {% for day in days %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link {% if loop.first %}active{% endif %}" 
                                            id="year2-{{ day.lower() }}-tab" 
                                            data-bs-toggle="tab" 
                                            data-bs-target="#year2-{{ day.lower() }}" 
                                            type="button" 
                                            role="tab" 
                                            aria-controls="year2-{{ day.lower() }}" 
                                            aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                        {{ day }}
                                    </button>
                                </li>
                            {% endfor %}
                        </ul>
                        
                        <div class="tab-content" id="year2DayTabsContent">
                            {% for day in days %}
                                <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                                    id="year2-{{ day.lower() }}" 
                                    role="tabpanel" 
                                    aria-labelledby="year2-{{ day.lower() }}-tab">
                                    
                                    {% set year2_entries = [] %}
                                    {% for entry in timetable_entries[day] %}
                                        {% if entry.year == 2 %}
                                            {% set _ = year2_entries.append(entry) %}
                                        {% endif %}
                                    {% endfor %}
                                    
                                    {% if year2_entries %}
                                        <div class="list-group">
                                            {% for entry in year2_entries %}
                                                <div class="list-group-item">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h5 class="mb-1">{{ entry.course.course_code }} - {{ entry.course.name }}</h5>
                                                            <p class="mb-1 text-muted">
                                                                <i class="fas fa-clock me-1"></i>{{ entry.start_time.strftime('%H:%M') }} - {{ entry.end_time.strftime('%H:%M') }}
                                                                <i class="fas fa-map-marker-alt ms-3 me-1"></i>{{ entry.room }}
                                                                <i class="fas fa-user ms-3 me-1"></i>{{ entry.faculty.name }}
                                                            </p>
                                                        </div>
                                                        <div>
                                                            <button type="button" class="btn btn-sm btn-primary edit-timetable-btn" 
                                                                   data-id="{{ entry.id }}"
                                                                   data-course-id="{{ entry.course_id }}"
                                                                   data-faculty-id="{{ entry.faculty_id }}"
                                                                   data-year="{{ entry.year }}"
                                                                   data-day="{{ entry.day }}"
                                                                   data-start-time="{{ entry.start_time.strftime('%H:%M') }}"
                                                                   data-end-time="{{ entry.end_time.strftime('%H:%M') }}"
                                                                   data-room="{{ entry.room }}">
                                                                <i class="fas fa-edit me-1"></i>Edit
                                                            </button>
                                                            <form method="POST" action="{{ url_for('admin.delete_timetable', timetable_id=entry.id) }}" class="d-inline" 
                                                                  onsubmit="return confirm('Are you sure you want to delete this timetable entry? This action cannot be undone.');">
                                                                <button type="submit" class="btn btn-sm btn-danger">
                                                                    <i class="fas fa-trash me-1"></i>Delete
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-calendar-times text-muted mb-3" style="font-size: 3rem;"></i>
                                            <h5 class="text-muted">No classes scheduled for Year 2 on {{ day }}</h5>
                                            <p>Add a new timetable entry using the form on the left</p>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Year 3 Tab Content -->
                    <div class="tab-pane fade" id="year-3" role="tabpanel" aria-labelledby="year-3-tab">
                        <!-- Days tabs for Year 3 -->
                        <ul class="nav nav-tabs mb-4" id="year3DayTabs" role="tablist">
                            {% for day in days %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link {% if loop.first %}active{% endif %}" 
                                            id="year3-{{ day.lower() }}-tab" 
                                            data-bs-toggle="tab" 
                                            data-bs-target="#year3-{{ day.lower() }}" 
                                            type="button" 
                                            role="tab" 
                                            aria-controls="year3-{{ day.lower() }}" 
                                            aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                        {{ day }}
                                    </button>
                                </li>
                            {% endfor %}
                        </ul>
                        
                        <div class="tab-content" id="year3DayTabsContent">
                            {% for day in days %}
                                <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                                    id="year3-{{ day.lower() }}" 
                                    role="tabpanel" 
                                    aria-labelledby="year3-{{ day.lower() }}-tab">
                                    
                                    {% set year3_entries = [] %}
                                    {% for entry in timetable_entries[day] %}
                                        {% if entry.year == 3 %}
                                            {% set _ = year3_entries.append(entry) %}
                                        {% endif %}
                                    {% endfor %}
                                    
                                    {% if year3_entries %}
                                        <div class="list-group">
                                            {% for entry in year3_entries %}
                                                <div class="list-group-item">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h5 class="mb-1">{{ entry.course.course_code }} - {{ entry.course.name }}</h5>
                                                            <p class="mb-1 text-muted">
                                                                <i class="fas fa-clock me-1"></i>{{ entry.start_time.strftime('%H:%M') }} - {{ entry.end_time.strftime('%H:%M') }}
                                                                <i class="fas fa-map-marker-alt ms-3 me-1"></i>{{ entry.room }}
                                                                <i class="fas fa-user ms-3 me-1"></i>{{ entry.faculty.name }}
                                                            </p>
                                                        </div>
                                                        <div>
                                                            <button type="button" class="btn btn-sm btn-primary edit-timetable-btn" 
                                                                   data-id="{{ entry.id }}"
                                                                   data-course-id="{{ entry.course_id }}"
                                                                   data-faculty-id="{{ entry.faculty_id }}"
                                                                   data-year="{{ entry.year }}"
                                                                   data-day="{{ entry.day }}"
                                                                   data-start-time="{{ entry.start_time.strftime('%H:%M') }}"
                                                                   data-end-time="{{ entry.end_time.strftime('%H:%M') }}"
                                                                   data-room="{{ entry.room }}">
                                                                <i class="fas fa-edit me-1"></i>Edit
                                                            </button>
                                                            <form method="POST" action="{{ url_for('admin.delete_timetable', timetable_id=entry.id) }}" class="d-inline" 
                                                                  onsubmit="return confirm('Are you sure you want to delete this timetable entry? This action cannot be undone.');">
                                                                <button type="submit" class="btn btn-sm btn-danger">
                                                                    <i class="fas fa-trash me-1"></i>Delete
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-calendar-times text-muted mb-3" style="font-size: 3rem;"></i>
                                            <h5 class="text-muted">No classes scheduled for Year 3 on {{ day }}</h5>
                                            <p>Add a new timetable entry using the form on the left</p>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Year 4 Tab Content -->
                    <div class="tab-pane fade" id="year-4" role="tabpanel" aria-labelledby="year-4-tab">
                        <!-- Days tabs for Year 4 -->
                        <ul class="nav nav-tabs mb-4" id="year4DayTabs" role="tablist">
                            {% for day in days %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link {% if loop.first %}active{% endif %}" 
                                            id="year4-{{ day.lower() }}-tab" 
                                            data-bs-toggle="tab" 
                                            data-bs-target="#year4-{{ day.lower() }}" 
                                            type="button" 
                                            role="tab" 
                                            aria-controls="year4-{{ day.lower() }}" 
                                            aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                        {{ day }}
                                    </button>
                                </li>
                            {% endfor %}
                        </ul>
                        
                        <div class="tab-content" id="year4DayTabsContent">
                            {% for day in days %}
                                <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                                    id="year4-{{ day.lower() }}" 
                                    role="tabpanel" 
                                    aria-labelledby="year4-{{ day.lower() }}-tab">
                                    
                                    {% set year4_entries = [] %}
                                    {% for entry in timetable_entries[day] %}
                                        {% if entry.year == 4 %}
                                            {% set _ = year4_entries.append(entry) %}
                                        {% endif %}
                                    {% endfor %}
                                    
                                    {% if year4_entries %}
                                        <div class="list-group">
                                            {% for entry in year4_entries %}
                                                <div class="list-group-item">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h5 class="mb-1">{{ entry.course.course_code }} - {{ entry.course.name }}</h5>
                                                            <p class="mb-1 text-muted">
                                                                <i class="fas fa-clock me-1"></i>{{ entry.start_time.strftime('%H:%M') }} - {{ entry.end_time.strftime('%H:%M') }}
                                                                <i class="fas fa-map-marker-alt ms-3 me-1"></i>{{ entry.room }}
                                                                <i class="fas fa-user ms-3 me-1"></i>{{ entry.faculty.name }}
                                                            </p>
                                                        </div>
                                                        <div>
                                                            <button type="button" class="btn btn-sm btn-primary edit-timetable-btn" 
                                                                   data-id="{{ entry.id }}"
                                                                   data-course-id="{{ entry.course_id }}"
                                                                   data-faculty-id="{{ entry.faculty_id }}"
                                                                   data-year="{{ entry.year }}"
                                                                   data-day="{{ entry.day }}"
                                                                   data-start-time="{{ entry.start_time.strftime('%H:%M') }}"
                                                                   data-end-time="{{ entry.end_time.strftime('%H:%M') }}"
                                                                   data-room="{{ entry.room }}">
                                                                <i class="fas fa-edit me-1"></i>Edit
                                                            </button>
                                                            <form method="POST" action="{{ url_for('admin.delete_timetable', timetable_id=entry.id) }}" class="d-inline" 
                                                                  onsubmit="return confirm('Are you sure you want to delete this timetable entry? This action cannot be undone.');">
                                                                <button type="submit" class="btn btn-sm btn-danger">
                                                                    <i class="fas fa-trash me-1"></i>Delete
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-calendar-times text-muted mb-3" style="font-size: 3rem;"></i>
                                            <h5 class="text-muted">No classes scheduled for Year 4 on {{ day }}</h5>
                                            <p>Add a new timetable entry using the form on the left</p>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Edit Functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle edit button clicks
    const editButtons = document.querySelectorAll('.edit-timetable-btn');
    const timetableForm = document.getElementById('timetableForm');
    const formTitle = document.getElementById('formTitle');
    const submitBtn = document.getElementById('submitBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const timetableIdInput = document.getElementById('timetable_id');
    const isUpdateInput = document.getElementById('is_update');

    editButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Get timetable data from data attributes
            const id = this.getAttribute('data-id');
            const courseId = this.getAttribute('data-course-id');
            const facultyId = this.getAttribute('data-faculty-id');
            const year = this.getAttribute('data-year');
            const day = this.getAttribute('data-day');
            const startTime = this.getAttribute('data-start-time');
            const endTime = this.getAttribute('data-end-time');
            const room = this.getAttribute('data-room');

            // Set form fields
            document.getElementById('course_id').value = courseId;
            document.getElementById('faculty_id').value = facultyId;
            document.getElementById('year').value = year;
            document.getElementById('day').value = day;
            document.getElementById('start_time').value = startTime;
            document.getElementById('end_time').value = endTime;
            document.getElementById('room').value = room;

            // Set hidden fields
            timetableIdInput.value = id;
            isUpdateInput.value = '1';

            // Update UI
            formTitle.textContent = 'Update Timetable Entry';
            submitBtn.textContent = 'Update';
            submitBtn.classList.replace('btn-info', 'btn-warning');
            cancelBtn.style.display = 'block';

            // Scroll to form
            document.querySelector('.card-header').scrollIntoView({ behavior: 'smooth' });
        });
    });

    // Handle cancel button
    cancelBtn.addEventListener('click', function() {
        // Reset form
        timetableForm.reset();

        // Reset hidden fields
        timetableIdInput.value = '';
        isUpdateInput.value = '0';

        // Update UI
        formTitle.textContent = 'Add Timetable Entry';
        submitBtn.textContent = 'Add Time Table Entry';
        submitBtn.classList.replace('btn-warning', 'btn-info');
        cancelBtn.style.display = 'none';
    });
});
</script>
{% endblock %}